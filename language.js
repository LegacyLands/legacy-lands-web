const translations = {
    en: {
        title: "Legacy Lands",
        orgTitle: "Commercial Organization",
        orgDescription: "A professional software development organization dedicated to creating elegant solutions.",
        // 组织成员部分
        roles: {
            founder: "Founder",
            mainplanner: "Main Planner",
            planner: "Planner",
            maindeveloper: "Main Developer",
            developer: "Developer",
            mainbuilder: "Main Builder",
            builder: "Builder"
        },
        // 使命部分
        missionTitle: "Legacy Lands Mission",
        missionSubtitle: "Create Excellence, Inherit Eternity",
        innovation: {
            title: "Innovation",
            subtitle: "Innovative Technology",
            description: "Dedicated to exploring and applying cutting-edge technologies to deliver ultimate gaming experiences. Continuously innovating to drive the advancement of game technology."
        },
        community: {
            title: "Community",
            subtitle: "Community Building",
            description: "Building a vibrant and creative gaming community where every player can find a sense of belonging and grow together."
        },
        // 联系部分
        contactTitle: "Contact Us",
        contactSubtitle: "Join us? Or contact us?",
        qqgroup: {
            title: "QQ Group",
            description: "Join our community",
            button: "Join Now"
        },
        github: {
            title: "GitHub",
            description: "Check our projects",
            button: "View Projects"
        },
        founder: {
            title: "Founder",
            description: "Contact the founder",
            button: "Send Email"
        },
        // 项目部分
        library: {
            title: "Legacy Lands Library",
            description: "Modern Java Library",
            tags: ["Framework", "Open Source", "Modern Java"],
            button: "View Repository"
        },
        server: {
            title: "Legacy Lands Server",
            description: "Main commercial projects",
            tags: ["Minecraft Server", "Civilization Simulation"],
            button: "Join QQ Group"
        },
        // 成员技能
        skills: {
            funding: "Funding",
            planning: "Planning",
            operationandmaintenance: "Operation and maintenance",
            java: "Java",
            elixir: "Elixir",
            frontend: "Frontend",
            backend: "Backend",
            bukkit: "Bukkit",
            devops: "DevOps",
            builder: "Builder",
            architectsofvariousstyles: "Architects of various styles",
            networktechnology: "Network Technology",
            hardwaredevelopment: "Hardware Development"
        },
        // 使命卡片
        heritage: {
            title: "Heritage",
            subtitle: "Cultural Heritage",
            description: "Perfectly blending gaming with culture, conveying positive values through unique gameplay and storytelling."
        },
        experience: {
            title: "Experience",
            subtitle: "User Experience First",
            description: "Dedicated to creating exceptional user experiences through meticulous design and seamless interactions. Every detail matters in crafting memorable gaming moments."
        },
        growth: {
            title: "Growth",
            subtitle: "Sustainable Development",
            description: "Fostering continuous growth through learning and adaptation. Building sustainable solutions that evolve with technology and community needs."
        },
        opensource: {
            title: "Open Source",
            subtitle: "Share & Contribute",
            description: "Committed to open source development and knowledge sharing. We believe in collaborative innovation and giving back to the developer community."
        },
        sections: {
            mission: "Legacy Lands Mission",
            library: "Legacy Lands Library",
            server: "Legacy Lands Server",
            contact: "Contact Us"
        },
        members: {
            xiaoliang: {
                name: "Xiao Liang",
                role: "Founder"
            },
            feige: {
                name: "Fei Ge",
                role: "Main Planner"
            },
            xiaochen: {
                name: "Xiao Chen",
                role: "Planner"
            },
            linxi: {
                name: "Lin Xi (Psyche)",
                role: "Main Developer"
            },
            sakuyaayane: {
                name: "SakuyaAyane",
                role: "Developer"
            },
            duoduojuzi: {
                name: "DuoDuo JuZi",
                role: "Developer"
            },
            lirenyuan: {
                name: "Li RenYuan",
                role: "Developer"
            },
            duya: {
                name: "Du Ya",
                role: "Main Builder"
            }
        }
    },
    zh: {
        title: "遗迹之地",
        orgTitle: "商业组织",
        orgDescription: "致力于创造优雅解决方案的专业软件开发组织。",
        // 组织成员部分
        roles: {
            founder: "创始人",
            mainplanner: "主策划",
            planner: "策划",
            maindeveloper: "主开发",
            developer: "开发",
            mainbuilder: "主建筑师",
            builder: "建筑师"
        },
        // 使命部分
        missionTitle: "遗迹之地使命",
        missionSubtitle: "创造不凡 传承永恒",
        innovation: {
            title: "创新",
            subtitle: "创新科技",
            description: "致力于探索和应用前沿技术，为玩家带来极致的游戏体验。通过不断创新，推动游戏技术的发展。"
        },
        community: {
            title: "社区",
            subtitle: "社区建设",
            description: "打造一个充满活力和创造力的游戏社区，让每位玩家都能找到归属感，共同成长。"
        },
        // 联系部分
        contactTitle: "联系我们",
        contactSubtitle: "加入我们？或者联系我们？",
        qqgroup: {
            title: "QQ 群",
            description: "加入我们的社区",
            button: "立即加入"
        },
        github: {
            title: "GitHub",
            description: "查看我们的项目",
            button: "查看项目"
        },
        founder: {
            title: "创始人",
            description: "联系创始人",
            button: "发送邮件"
        },
        // 项目部分
        library: {
            title: "遗迹之地库",
            description: "现代 Java 依赖库",
            tags: ["框架", "开源", "现代 Java"],
            button: "查看仓库"
        },
        server: {
            title: "遗迹之地服务器",
            description: "主要商业项目",
            tags: ["我的世界服务器", "文明模拟"],
            button: "加入 QQ 群"
        },
        // 成员技能
        skills: {
            funding: "融资",
            planning: "策划",
            operationandmaintenance: "运维",
            java: "Java",
            elixir: "Elixir",
            frontend: "前端",
            backend: "后端",
            bukkit: "Bukkit",
            devops: "运维",
            builder: "建筑",
            architectsofvariousstyles: "多风格建筑师",
            networktechnology: "网络技术",
            hardwaredevelopment: "电子硬件"
        },
        // 使命卡片
        heritage: {
            title: "传承",
            subtitle: "文化传承",
            description: "将游戏与文化完美融合，通过独特的游戏玩法和故事，传递积极的价值观。"
        },
        experience: {
            title: "体验",
            subtitle: "用户体验至上",
            description: "致力于通过精心设计和流畅交互创造卓越的用户体验。每一个细节都在打造难忘的游戏时刻。"
        },
        growth: {
            title: "成长",
            subtitle: "可持续发展",
            description: "通过学习和适应促进持续成长。构建随技术和社区需求发展的可持续解决方案。"
        },
        opensource: {
            title: "开源",
            subtitle: "分享与贡献",
            description: "致力于开源开发和知识共享。我们相信协作创新，并回馈开发者社区。"
        },
        sections: {
            mission: "遗迹之地使命",
            library: "遗迹之地库",
            server: "遗迹之地服务器",
            contact: "联系我们"
        },
        members: {
            xiaoliang: {
                name: "小梁",
                role: "创始人"
            },
            feige: {
                name: "飞鸽",
                role: "主策划"
            },
            xiaochen: {
                name: "小陈",
                role: "策划"
            },
            linxi: {
                name: "林希 (Psyche)",
                role: "主开发"
            },
            sakuyaayane: {
                name: "咲夜绫音",
                role: "开发"
            },
            duoduojuzi: {
                name: "多多橘子",
                role: "开发"
            },
            lirenyuan: {
                name: "李任渊",
                role: "开发"
            },
            duya: {
                name: "渡鸦",
                role: "主建筑师"
            }
        }
    }
};

let currentLang = 'en';  // 默认英文
let originalAttributes = null;

function setAllAttributes() {
    if (!originalAttributes) {
        originalAttributes = {
            members: [],
            skills: [],
            missions: [],
            contacts: []
        };

        // 保存成员卡片的原始属性
        document.querySelectorAll('.member-card').forEach(card => {
            const name = card.querySelector('h3').textContent;
            const memberId = name.toLowerCase()
                .replace(/\s*\([^)]*\)\s*/g, '') // 移除括号及其内容
                .replace(/\s+/g, '') // 移除空格
                .replace(/[^a-z]/g, ''); // 只保留小写字母

            originalAttributes.members.push({
                element: card,
                name: name,
                id: memberId
            });
        });

        // 保存技能的原始属性
        document.querySelectorAll('.member-skills span').forEach(skill => {
            originalAttributes.skills.push({
                element: skill,
                text: skill.textContent
            });
        });

        // 修改使命卡片的属性保存
        document.querySelectorAll('.mission-card').forEach(card => {
            const title = card.querySelector('h3').textContent;
            const type = title.toLowerCase()
                .replace(/[\s&]+/g, '')
                .replace(/[^a-z]/g, '');
            originalAttributes.missions.push({
                element: card,
                title: title,
                type: type
            });
        });

        // 修改联系卡片的属性保存
        document.querySelectorAll('.contact-card').forEach(card => {
            const title = card.querySelector('h3').textContent;
            const type = title.toLowerCase()
                .replace(/[\s&]+/g, '')
                .replace(/[^a-z]/g, '');
            originalAttributes.contacts.push({
                element: card,
                title: title,
                type: type
            });
        });
    }

    // 使用原始属性来设置 data 属性
    originalAttributes.members.forEach(item => {
        item.element.setAttribute('data-member', item.id);
    });

    originalAttributes.skills.forEach(item => {
        const skillKey = item.text.toLowerCase()
            .replace(/[\s&]+/g, '')
            .replace(/[^a-z]/g, '');
        item.element.setAttribute('data-skill', skillKey);
    });

    // 修改使命卡片的属性设置
    originalAttributes.missions.forEach(item => {
        item.element.setAttribute('data-type', item.type);
    });

    // 修改联系卡片的属性设置
    originalAttributes.contacts.forEach(item => {
        item.element.setAttribute('data-type', item.type);
    });
}

function updateButtonText() {
    const langBtn = document.querySelector('.lang-btn');
    if (langBtn) {
        const langText = langBtn.querySelector('.lang-text');
        if (langText) {
            // 当前是英文时显示"中文"，当前是中文时显示"English"
            langText.textContent = currentLang === 'en' ? '中文' : 'English';
        }
    }
}

function toggleLanguage() {
    currentLang = currentLang === 'en' ? 'zh' : 'en';
    console.log('Language switched to:', currentLang);
    
    // 先更新内容
    updateContent();
    // 然后重新设置属性
    setAllAttributes();
    // 最后更新按钮文本
    updateButtonText();
}

function updateContent() {
    console.log('Starting content update, current language:', currentLang);
    const t = translations[currentLang];

    // 添加调试信息
    const debugElements = {
        mainTitle: document.querySelector('.main-title'),
        logo: document.querySelector('.logo'),
        orgTitle: document.querySelector('.org-title'),
        orgDesc: document.querySelector('.org-description'),
        missionTitle: document.querySelector('.mission-title'),
        contactTitle: document.querySelector('.contact-title'),
        codeSections: document.querySelectorAll('.code-section'),
        missionCards: document.querySelector('.mission-section')?.querySelectorAll('.mission-card'),
        contactCards: document.querySelector('.contact-section')?.querySelectorAll('.contact-card')
    };

    console.log('Found elements:', Object.entries(debugElements).reduce((acc, [key, el]) => {
        acc[key] = el ? (el.length || true) : false;
        return acc;
    }, {}));

    // 添加更多调试信息
    document.querySelectorAll('.member-skills span').forEach(skill => {
        const skillKey = skill.getAttribute('data-skill');
        const oldText = skill.textContent;
        const newText = t.skills[skillKey];
        console.log(`Updating skill: ${oldText} -> ${newText} (key: ${skillKey})`);
    });

    // 主标题和Logo
    document.querySelector('.main-title').textContent = t.title;
    document.querySelector('.logo').textContent = t.title;

    // 组织部分
    document.querySelector('.org-title').textContent = t.orgTitle;
    document.querySelector('.org-description').textContent = t.orgDescription;

    // 成员部分
    document.querySelectorAll('.member-card').forEach(card => {
        const memberId = card.getAttribute('data-member');
        if (t.members[memberId]) {
            card.querySelector('h3').textContent = t.members[memberId].name;
            card.querySelector('p').textContent = t.members[memberId].role;
        } else {
            console.warn('Missing translation for member:', memberId);
        }
    });

    // 成员技能
    document.querySelectorAll('.member-skills span').forEach(skill => {
        const skillKey = skill.getAttribute('data-skill');
        if (t.skills[skillKey]) {
            skill.textContent = t.skills[skillKey];
        } else {
            console.warn('Missing translation for skill:', skillKey);
        }
    });

    // 项目部分
    const codeSections = document.querySelectorAll('.code-section');
    codeSections.forEach((section, index) => {
        if (index === 0) {
            // Library section
            const descContent = section.querySelector('.description-content');
            if (descContent) {
                descContent.querySelector('h2').textContent = t.sections.library;
                descContent.querySelector('p').textContent = t.library.description;
                const tags = descContent.querySelectorAll('.feature-tags span');
                tags.forEach((tag, i) => {
                    if (t.library.tags[i]) {
                        tag.textContent = t.library.tags[i];
                    }
                });
                const githubLink = descContent.querySelector('.github-link');
                if (githubLink) {
                    // 清除现有内容
                    githubLink.innerHTML = '';
                    // 添加图标
                    const iconSpan = document.createElement('span');
                    iconSpan.className = 'github-icon';
                    iconSpan.innerHTML = `
                        <svg height="24" viewBox="0 0 16 16" width="24">
                            <path fill="#d4d4d4" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
                        </svg>
                    `;
                    // 添加文本
                    githubLink.appendChild(iconSpan);
                    githubLink.appendChild(document.createTextNode(t.library.button));
                }
            }
        } else if (index === 1) {
            // Server section
            const descContent = section.querySelector('.description-content');
            if (descContent) {
                descContent.querySelector('h2').textContent = t.sections.server;
                descContent.querySelector('p').textContent = t.server.description;
                const tags = descContent.querySelectorAll('.feature-tags span');
                tags.forEach((tag, i) => {
                    if (t.server.tags[i]) {
                        tag.textContent = t.server.tags[i];
                    }
                });
                const qqLink = descContent.querySelector('.qq-link');
                if (qqLink) {
                    // 清除现有内容
                    qqLink.innerHTML = '';
                    // 添加图标
                    const iconSpan = document.createElement('span');
                    iconSpan.className = 'qq-icon';
                    iconSpan.innerHTML = `
                        <svg height="24" viewBox="0 0 24 24" width="24">
                            <path fill="#d4d4d4" d="M12.003 2c-2.265 0-6.29 1.364-6.29 7.325v1.195S3.55 14.96 3.55 17.474c0 .665.17 1.025.281 1.025.114 0 .902-.484 1.748-2.072 0 0-.18 2.197 1.904 3.967 0 0-1.77.495-1.77 1.182 0 .686 4.078.43 6.29.43 2.213 0 6.29.256 6.29-.43 0-.687-1.77-1.182-1.77-1.182 2.085-1.77 1.905-3.967 1.905-3.967.846 1.588 1.634 2.072 1.746 2.072.111 0 .283-.36.283-1.025 0-2.514-2.166-6.954-2.166-6.954V9.325C18.29 3.364 14.268 2 12.003 2z" />
                        </svg>
                    `;
                    // 添加文本
                    qqLink.appendChild(iconSpan);
                    qqLink.appendChild(document.createTextNode(t.server.button));
                }
            }
        }
    });

    // 使命部分
    const missionSection = document.querySelector('.mission-section');
    if (missionSection) {
        missionSection.querySelector('.mission-title').textContent = t.sections.mission;
        missionSection.querySelector('.mission-subtitle').textContent = t.missionSubtitle;

        // 使命卡片
        const missionCards = missionSection.querySelectorAll('.mission-card');
        missionCards.forEach(card => {
            const type = card.getAttribute('data-type');
            if (t[type]) {
                card.querySelector('h3').textContent = t[type].title;
                card.querySelector('h4').textContent = t[type].subtitle;
                card.querySelector('p').textContent = t[type].description;
            } else {
                console.warn('Missing translation for mission card:', type);
            }
        });
    }

    // 联系部分
    const contactSection = document.querySelector('.contact-section');
    if (contactSection) {
        contactSection.querySelector('.contact-title').textContent = t.sections.contact;
        contactSection.querySelector('.contact-subtitle').textContent = t.contactSubtitle;

        // 联系卡片
        const contactCards = contactSection.querySelectorAll('.contact-card');
        contactCards.forEach(card => {
            const type = card.getAttribute('data-type');
            if (t[type]) {
                card.querySelector('h3').textContent = t[type].title;
                card.querySelector('p').textContent = t[type].description;
                const link = card.querySelector('.contact-link');
                if (link) {
                    // 清除现有内容
                    link.innerHTML = '';
                    // 添加文本
                    link.appendChild(document.createTextNode(t[type].button));
                    // 添加箭头图标
                    const svg = document.createElement('svg');
                    svg.setAttribute('width', '24');
                    svg.setAttribute('height', '24');
                    svg.setAttribute('viewBox', '0 0 24 24');
                    svg.innerHTML = '<path fill="#d4d4d4" d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />';
                    link.appendChild(svg);
                }
            } else {
                console.warn('Missing translation for contact card:', type);
            }
        });
    }

    // 页脚
    const footer = document.querySelector('.footer p');
    if (footer) {
        footer.textContent = currentLang === 'en'
            ? "© 2024 Legacy Lands Studio. All rights reserved."
            : "© 2024 遗迹之地工作室。保留所有权利。";
    }
}

// 页面加载完成后初始化语言
document.addEventListener('DOMContentLoaded', () => {
    // 首先设置所有属性
    setAllAttributes();
    
    // 绑定按钮事件
    const langBtn = document.querySelector('.lang-btn');
    if (langBtn) {
        langBtn.removeEventListener('click', toggleLanguage);
        langBtn.addEventListener('click', (e) => {
            e.preventDefault();
            toggleLanguage();
        });
    }
    
    // 初始化内容和按钮文本
    updateContent();
    updateButtonText();
}); 